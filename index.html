<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Taxi App ‚Äì Kompletn√° verzia</title>
<style>
body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; background:#f2f2f2; margin:0; padding:15px; }
h1 { text-align:center; }
.card { background:white; padding:15px; border-radius:12px; margin-bottom:15px; }
label { font-weight:600; display:block; margin-top:10px; }
input, select { width:100%; padding:10px; font-size:16px; margin-top:5px; }
.result { font-size:18px; margin-top:10px; font-weight:bold; }
.green { color:green; }
.red { color:red; }
.hidden { display:none; }
</style>
</head>
<body>

<h1>üöï Taxi aplik√°cia ‚Äì Kompletn√° verzia</h1>

<div class="card">
  <label>Re≈æim aplik√°cie</label>
  <select id="mode">
    <option value="costs">Kalkulaƒçka n√°kladov</option>
    <option value="taximeter">Taxameter</option>
  </select>
</div>

<!-- KALKULAƒåKA N√ÅKLADOV -->
<div id="costs" class="card">
  <label>Sadzba za 1 km (n√°klady)</label>
  <input type="number" id="costRate" value="0.31" step="0.01">
  <label>Najazden√© kilometre</label>
  <input type="number" id="costKm" value="0" step="0.1">
  <label>Cena jazdy (zad√° vodiƒç)</label>
  <input type="number" id="ridePrice" value="0" step="0.1">
</div>

<!-- TAXAMETER -->
<div id="taximeter" class="card hidden">
  <label>Poloha vozidla (GPS, Lat,Lon)</label>
  <input type="text" id="vehiclePos" placeholder="Naƒç√≠tanie polohy..." readonly>

  <label>Adresa n√°stupu klienta (Lat,Lon)</label>
  <input type="text" id="startAddress" placeholder="napr. 48.1486,17.1077">

  <label>Adresa v√Ωstupu klienta (Lat,Lon)</label>
  <input type="text" id="endAddress" placeholder="napr. 48.1480,17.1100">

  <label>Sadzba pristavenie</label>
  <input type="number" id="startRate" value="0.40" step="0.01">

  <label>Sadzba za 1 km</label>
  <input type="number" id="kmRate" value="0.85" step="0.01">

  <label>Pr√≠platky</label>
  <input type="number" id="extras" value="0" step="0.1">
</div>

<div id="results" class="card result">V√Ωsledok sa zobraz√≠ tu</div>

<script>
// prep√≠naƒç re≈æimov
const mode = document.getElementById("mode");
const costsDiv = document.getElementById("costs");
const taximeterDiv = document.getElementById("taximeter");

mode.onchange = () => {
  costsDiv.classList.toggle("hidden", mode.value !== "costs");
  taximeterDiv.classList.toggle("hidden", mode.value !== "taximeter");
  calculateAll();
};

// pripojenie vstupov
document.querySelectorAll("input").forEach(i => i.oninput = calculateAll);

// inicializ√°cia GPS
function updateGPS() {
  const vehicleInput = document.getElementById("vehiclePos");
  if(!navigator.geolocation){
    vehicleInput.value = "GPS nie je podporovan√©";
    return;
  }
  navigator.geolocation.getCurrentPosition(
    pos => {
      const lat = pos.coords.latitude.toFixed(6);
      const lon = pos.coords.longitude.toFixed(6);
      vehicleInput.value = `${lat},${lon}`;
      calculateAll();
    },
    err => { vehicleInput.value = "GPS zlyhalo, zadaj ruƒçne"; }
  );
}
updateGPS();

// hlavn√° funkcia
async function calculateAll() {
  if(mode.value === "costs"){
    calculateCosts();
  } else {
    await calculateTaximeterOSRM();
  }
}

// kalkulaƒçka n√°kladov
function calculateCosts(){
  const rate = +document.getElementById("costRate").value;
  const km = +document.getElementById("costKm").value;
  const price = +document.getElementById("ridePrice").value;

  const costsValue = rate * km;
  const provizia = price * 0.25;
  const dph = provizia * 0.23;
  const totalCosts = costsValue + provizia + dph;
  const profit = price - totalCosts;

  const result = document.getElementById("results");
  result.innerText = `N√°klady: ${costsValue.toFixed(2)} ‚Ç¨ | Prov√≠zia: ${provizia.toFixed(2)} ‚Ç¨ | DPH: ${dph.toFixed(2)} ‚Ç¨ | Celkov√© n√°klady: ${totalCosts.toFixed(2)} ‚Ç¨ | Zisk: ${profit.toFixed(2)} ‚Ç¨`;
  result.className = "result " + (profit>=0?"green":"red");
}

// OSRM vzdialenos≈•
async function getDistanceOSRM(startLat, startLon, endLat, endLon){
  const url = `https://router.project-osrm.org/route/v1/driving/${startLon},${startLat};${endLon},${endLat}?overview=false`;
  try{
    const res = await fetch(url);
    const data = await res.json();
    if(data.routes && data.routes.length>0) return data.routes[0].distance/1000;
    return 0;
  } catch(e){
    console.error("OSRM error", e);
    return 0;
  }
}

// taxameter s OSRM
async function calculateTaximeterOSRM(){
  const vehicle = document.getElementById("vehiclePos").value.split(",");
  const start = document.getElementById("startAddress").value.split(",");
  const end = document.getElementById("endAddress").value.split(",");

  if(vehicle.length<2 || start.length<2 || end.length<2) return;

  const kmToClient = await getDistanceOSRM(+vehicle[0], +vehicle[1], +start[0], +start[1]);
  const kmWithClient = await getDistanceOSRM(+start[0], +start[1], +end[0], +end[1]);

  const startRate = +document.getElementById("startRate").value;
  const kmRate = +document.getElementById("kmRate").value;
  const extras = +document.getElementById("extras").value;

  const ridePrice = kmToClient*startRate + kmWithClient*kmRate + extras;
  const provizia = ridePrice*0.25;
  const dph = provizia*0.23;
  const totalCosts = provizia + dph;
  const profit = ridePrice - totalCosts;

  const result = document.getElementById("results");
  result.innerText = `Cena jazdy: ${ridePrice.toFixed(2)} ‚Ç¨ | Prov√≠zia: ${provizia.toFixed(2)} ‚Ç¨ | DPH: ${dph.toFixed(2)} ‚Ç¨ | Zisk: ${profit.toFixed(2)} ‚Ç¨`;
  result.className = "result " + (profit>=0?"green":"red");
}
</script>

</body>
</html>
